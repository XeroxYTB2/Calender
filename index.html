<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Calendrier de l'Avent</title>
<style>
    body {
        background:#0f3f36;
        font-family: Arial, sans-serif;
        display:flex;
        flex-direction:column;
        align-items:center;
        padding:20px;
        color:white;
        position:relative;
    }
    h1 { margin-bottom:20px; font-size:2.5em; }
    #calendar {
        display:grid;
        grid-template-columns: repeat(6, 200px);
        grid-gap:20px;
    }
    .day {
        width:200px;
        height:180px;
        background:#b42222;
        color:white;
        border-radius:10px;
        display:flex;
        flex-direction:column;
        justify-content:center;
        align-items:center;
        cursor:pointer;
        font-size:24px;
        transition:0.3s;
        border:3px solid #8c1e1e;
    }
    .opened {
        background:#e4d32b;
        color:black;
        border:3px solid #c7b924;
    }
    .label { font-size:16px; margin-top:8px; text-align:center; }
    #resetBtn {
        margin-top:30px;
        padding:12px 24px;
        font-size:20px;
        border:none;
        border-radius:8px;
        background:#d9534f;
        color:white;
        cursor:pointer;
        transition:0.3s;
    }
    #resetBtn:hover { background:#c9302c; }
    #fullscreenBtn {
        position:fixed;
        top:20px;
        right:20px;
        width:60px;
        height:60px;
        background:#ffffffcc;
        border-radius:50%;
        display:flex;
        align-items:center;
        justify-content:center;
        cursor:pointer;
        font-size:26px;
        color:#0f3f36;
        transition:0.3s;
        border:none;
        z-index:999;
    }
    #fullscreenBtn:hover { background:white; transform:scale(1.1); }

    #popupOverlay {
        position: fixed;
        top:0; left:0;
        width:100%; height:100%;
        background: rgba(0,0,0,0.55);
        backdrop-filter: blur(4px);
        display:flex;
        align-items:center;
        justify-content:center;
        visibility:hidden;
        opacity:0;
        transition:0.25s;
        z-index:1000;
    }
    #popupOverlay.active { visibility: visible; opacity:1; }
    #popupBox {
        background:white;
        color:black;
        width:400px;
        padding:30px;
        border-radius:18px;
        text-align:center;
        box-shadow:0 8px 25px rgba(0,0,0,0.4);
        transform:scale(0.8);
        transition:0.25s;
        position:relative;
    }
    #popupOverlay.active #popupBox { transform:scale(1); }
    #popupMessage { font-size:20px; margin-bottom:20px; }
    .popupBtn {
        padding:10px 15px;
        font-size:16px;
        border:none;
        border-radius:10px;
        cursor:pointer;
        margin:5px;
    }
    .btnConfirm { background:#4CAF50; color:white; }
    .btnCancel { background:#d9534f; color:white; }

    /* Drapeau allemand */
    #germanFlag {
        width:200px;
        height:120px;
        margin:15px auto;
        border:2px solid #000;
        cursor:pointer;
        position:relative;
    }
    .stripe {
        width:100%;
        height:33.33%;
        transition:background 0.5s;
    }
    #black { background:black; opacity:0; }
    #red { background:red; opacity:0; }
    #yellow { background:yellow; opacity:0; }

    /* Confettis */
    .confetti {
        position:absolute;
        width:8px;
        height:8px;
        border-radius:50%;
        pointer-events:none;
        animation:fall 1s forwards;
    }
    @keyframes fall {
        0% { transform:translateY(0) scale(1); opacity:1; }
        100% { transform:translateY(200px) scale(0.5); opacity:0; }
    }
</style>
</head>
<body>

<button id="fullscreenBtn">‚õ∂</button>

<h1>üéÑ Calendrier de l'Avent üéÑ</h1>

<div id="calendar"></div>
<button id="resetBtn">Annuler la derni√®re ouverture</button>

<div id="popupOverlay">
    <div id="popupBox">
        <div id="popupMessage"></div>
        <div id="flagContainer"></div>
        <div id="popupButtons"></div>
    </div>
</div>

<script>
// ---------------------------
// POPUP CUSTOM
// ---------------------------
function showPopup(message, buttons = [], extraHTML = "") {
    const overlay = document.getElementById("popupOverlay");
    const msgBox = document.getElementById("popupMessage");
    const btnBox = document.getElementById("popupButtons");
    const flagContainer = document.getElementById("flagContainer");

    msgBox.textContent = message;
    btnBox.innerHTML = "";
    flagContainer.innerHTML = extraHTML;

    buttons.forEach(btn => {
        const b = document.createElement("button");
        b.textContent = btn.text;
        b.className = "popupBtn " + (btn.class || "");
        b.onclick = () => {
            overlay.classList.remove("active");
            if (btn.action) btn.action();
        };
        btnBox.appendChild(b);
    });

    overlay.classList.add("active");
}

// ---------------------------
// G√âN√âRATION CALENDRIER
// ---------------------------
const calendar = document.getElementById("calendar");
let openedDays = JSON.parse(localStorage.getItem("openedDays")) || [];

function createCalendar() {
    calendar.innerHTML = "";
    for (let i = 1; i <= 24; i++) {
        const div = document.createElement("div");
        div.classList.add("day");
        div.dataset.day = i;
        div.innerHTML = `
            <div>‚≠ê</div>
            <div>${i}</div>
            <div class="label">${openedDays.includes(i) ? "D√©j√† ouverte üéÅ" : "√Ä ouvrir üéÑ"}</div>
        `;
        if (openedDays.includes(i)) div.classList.add("opened");
        div.onclick = () => openDay(i, div);
        calendar.appendChild(div);
    }
}

// ---------------------------
// OUVERTURE CASE
// ---------------------------
function openDay(day, element) {
    if(day === 1 && !openedDays.includes(1)){
        // Premi√®re case sp√©ciale
        const flagHTML = `
        <div id="germanFlag">
            <div class="stripe" id="black"></div>
            <div class="stripe" id="red"></div>
            <div class="stripe" id="yellow"></div>
        </div>`;
        showPopup("Welche Farbe hat die Deutsche Flagge ?", [
            { text:"OK", class:"btnConfirm" }
        ], flagHTML);

        const flag = document.getElementById("germanFlag");
        flag.onclick = () => {
            document.getElementById("black").style.opacity = 1;
            document.getElementById("red").style.opacity = 1;
            document.getElementById("yellow").style.opacity = 1;
            triggerConfetti(flag, ["black","red","yellow"]);
        };
    } else {
        showPopup("üéÅ Tu as ouvert la case " + day + " !", [
            { text:"OK", class:"btnConfirm" }
        ]);
    }

    if (!openedDays.includes(day)) {
        openedDays.push(day);
        localStorage.setItem("openedDays", JSON.stringify(openedDays));
    }
    element.classList.add("opened");
    element.querySelector(".label").textContent = "D√©j√† ouverte üéÅ";
}

// ---------------------------
// CONFETTI
// ---------------------------
function triggerConfetti(element, colors){
    for(let i=0;i<50;i++){
        const conf = document.createElement("div");
        conf.classList.add("confetti");
        conf.style.background = colors[Math.floor(Math.random()*colors.length)];
        conf.style.left = Math.random()*element.offsetWidth + "px";
        conf.style.top = Math.random()*element.offsetHeight + "px";
        element.appendChild(conf);
        setTimeout(()=>conf.remove(),1000 + Math.random()*500);
    }
}

// ---------------------------
// RESET DERNI√àRE CASE
// ---------------------------
document.getElementById("resetBtn").onclick = () => {
    if (openedDays.length === 0) {
        showPopup("‚ùó Aucune case ouverte √† annuler.", [
            { text:"OK", class:"btnConfirm" }
        ]);
        return;
    }
    const last = openedDays[openedDays.length - 1];
    showPopup("‚ùì Annuler l‚Äôouverture de la case " + last + " ?", [
        {
            text:"Oui",
            class:"btnConfirm",
            action: () => {
                openedDays.pop();
                localStorage.setItem("openedDays", JSON.stringify(openedDays));
                createCalendar();
            }
        },
        { text:"Non", class:"btnCancel" }
    ]);
};

// ---------------------------
// MODE PLEIN ECRAN
// ---------------------------
const fullscreenBtn = document.getElementById("fullscreenBtn");
fullscreenBtn.onclick = () => {
    if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
        fullscreenBtn.textContent = "ü°∏";
    } else {
        document.exitFullscreen();
        fullscreenBtn.textContent = "‚õ∂";
    }
};
document.addEventListener("fullscreenchange", () => {
    if (!document.fullscreenElement) fullscreenBtn.textContent = "‚õ∂";
});

// ---------------------------
// INIT
// ---------------------------
createCalendar();
</script>
</body>
</html>
